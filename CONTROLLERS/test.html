
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<style>
			body {
				background: black;
				color: rgb(80, 80, 80);
			}
			body, pre, #legend span {
				font-family: Menlo, monospace;
				font-weight: bold;
			}
			#topbar {
				background: black;
				position: fixed;
				top: 0; left: 0; right: 0;
				height: 42px;
				border-bottom: 1px solid rgb(80, 80, 80);
			}
			#content {
				margin-top: 50px;
			}
			#nav, #legend {
				float: left;
				margin-left: 10px;
			}
			#legend {
				margin-top: 12px;
			}
			#nav {
				margin-top: 10px;
			}
			#legend span {
				margin: 0 5px;
			}
			.cov0 { color: rgb(192, 0, 0) }
.cov1 { color: rgb(128, 128, 128) }
.cov2 { color: rgb(116, 140, 131) }
.cov3 { color: rgb(104, 152, 134) }
.cov4 { color: rgb(92, 164, 137) }
.cov5 { color: rgb(80, 176, 140) }
.cov6 { color: rgb(68, 188, 143) }
.cov7 { color: rgb(56, 200, 146) }
.cov8 { color: rgb(44, 212, 149) }
.cov9 { color: rgb(32, 224, 152) }
.cov10 { color: rgb(20, 236, 155) }

		</style>
	</head>
	<body>
		<div id="topbar">
			<div id="nav">
				<select id="files">
				
				<option value="file0">ROOMS/CONTROLLERS/AUTH.go (0.0%)</option>
				
				<option value="file1">ROOMS/CONTROLLERS/BILLCONTROLLER.go (0.0%)</option>
				
				<option value="file2">ROOMS/CONTROLLERS/BLOCKCONTROLLER.go (0.0%)</option>
				
				<option value="file3">ROOMS/CONTROLLERS/CONTRACTCONTROLLER.go (0.0%)</option>
				
				<option value="file4">ROOMS/CONTROLLERS/CUSTOMERCONTROLLER.go (0.0%)</option>
				
				<option value="file5">ROOMS/CONTROLLERS/Cache.go (0.0%)</option>
				
				<option value="file6">ROOMS/CONTROLLERS/DEFAULT_SERVICECONTROLLER.go (0.0%)</option>
				
				<option value="file7">ROOMS/CONTROLLERS/INIT.go (0.0%)</option>
				
				<option value="file8">ROOMS/CONTROLLERS/ROOMCONTROLLER.go (0.0%)</option>
				
				<option value="file9">ROOMS/CONTROLLERS/SERVICECONTROLLER.go (0.0%)</option>
				
				<option value="file10">ROOMS/CONTROLLERS/UNITCONTROLLER.go (100.0%)</option>
				
				<option value="file11">ROOMS/CONTROLLERS/UPLOADFILE.go (0.0%)</option>
				
				<option value="file12">ROOMS/CONTROLLERS/USERCONTROLLER.go (0.0%)</option>
				
				</select>
			</div>
			<div id="legend">
				<span>not tracked</span>
			
				<span class="cov0">not covered</span>
				<span class="cov8">covered</span>
			
			</div>
		</div>
		<div id="content">
		
		<pre class="file" id="file0" style="display: none">package CONTROLLERS

import (
        "ROOMS/DATABASE"
        jwtmiddleware "github.com/auth0/go-jwt-middleware"
        "github.com/dgrijalva/jwt-go"
        "io"
        "log"
        "net/http"
)

func AuthMiddleware(next http.Handler) http.Handler <span class="cov0" title="0">{
        if len(DATABASE.APP_KEY) == 0 </span><span class="cov0" title="0">{
                log.Fatal("HTTP server unable to start, expected an APP_KEY for JWT auth")
        }</span>
        <span class="cov0" title="0">jwtMiddleware := jwtmiddleware.New(jwtmiddleware.Options{
                Extractor: jwtmiddleware.FromFirst(jwtmiddleware.FromAuthHeader,
                        jwtmiddleware.FromParameter("token")),
                ValidationKeyGetter: func(token *jwt.Token) (interface{}, error) </span><span class="cov0" title="0">{
                        return []byte(DATABASE.APP_KEY), nil
                }</span>,
                SigningMethod: jwt.SigningMethodHS256,
        })
        <span class="cov0" title="0">return jwtMiddleware.Handler(next)</span>
}

func ValidateToken(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{
        w.Header().Add("Content-Type", "application/json")
        stringresult := `{
                "status": 200,
                        "message": "Validate success",
                        "data": {
                        "status": 1
                }
        }`
        io.WriteString(w, stringresult)
        return
}</span>
</pre>
		
		<pre class="file" id="file1" style="display: none">package CONTROLLERS

import (
        "ROOMS/BUSINESS"
        "ROOMS/MODELS"
        "encoding/json"
        "github.com/gorilla/mux"
        "io"
        "log"
        "net/http"
        "strconv"
)

func (a *ApiDB)GetBills(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{

        type Data struct {
                Bill       MODELS.BILLS          `json:"bill"`
                Billdetail []MODELS.BILL_DETAILS `json:"billdetail"`
        }
        type Result struct {
                Status  int    `json:"status"`
                Message string `json:"message"`
                Data    Data   `json:"data"`
        }

        w.Header().Add("Content-Type", "application/json")
        vars := mux.Vars(r)
        idBill, err := strconv.Atoi(vars["id"])

        if err != nil </span><span class="cov0" title="0">{
                //w.WriteHeader(http.StatusBadRequest)
                io.WriteString(w, `{"message":"can not convert id as int"}`)

                return
        }</span>
        <span class="cov0" title="0">billinfo, okinfo, err := BUSINESS.GetBillById(a.Db,idBill)
        billdetail, okdetail, err := BUSINESS.GetBillDetailById(a.Db,idBill)
        if okinfo != true || okdetail != true </span><span class="cov0" title="0">{
                io.WriteString(w, `{ "message": "Can’t get contracts" }`)
                return
        }</span>
        <span class="cov0" title="0">result := Result{
                Status:  200,
                Message: "get bill success",
                Data: Data{
                        Bill:       billinfo,
                        Billdetail: billdetail,
                },
        }

        jsonresult, errjson := json.Marshal(result)
        if errjson != nil </span><span class="cov0" title="0">{
                log.Print("err while convert json :", err.Error())
        }</span>

        <span class="cov0" title="0">io.WriteString(w, string(jsonresult))</span>
}

func (a *ApiDB)CreateBill(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{
        w.Header().Add("Content-Type", "application/json")
        p := MODELS.CREATE_UPDATE_BILL_REQUEST{}
        err := json.NewDecoder(r.Body).Decode(&amp;p)
        if err != nil </span><span class="cov0" title="0">{
                io.WriteString(w, `{"message": "wrong format!"}`+err.Error())
                return
        }</span>

        <span class="cov0" title="0">result, err := BUSINESS.CreateBill(a.Db,p)
        if result &gt; 0 </span><span class="cov0" title="0">{
                io.WriteString(w, `  { "status": 200,
    "message": "Create bill success",
    "data": {
        "status": 1
    }
}
`)
        }</span> else<span class="cov0" title="0"> {
                io.WriteString(w, `{ "message": "Can’t create bill"}`)
        }</span>
}

func (a *ApiDB)UpdateBill(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{
        w.Header().Add("Content-Type", "application/json")

        vars := mux.Vars(r)
        idContract, _ := strconv.Atoi(vars["id"])

        var p = MODELS.CREATE_UPDATE_BILL_REQUEST{}

        err := json.NewDecoder(r.Body).Decode(&amp;p)
        if err != nil </span><span class="cov0" title="0">{
                io.WriteString(w, `{ "message": "Wrong format" }`)
                return
        }</span>

        <span class="cov0" title="0">p.Id = idContract
        res, _ := BUSINESS.UpdateBill(a.Db,p)

        if res </span><span class="cov0" title="0">{
                io.WriteString(w, `{
                                                "status": 200,
                                                "message": "Update bill success",
                                                "data": {
                                                        "status": 1
                                                        }
                                                }`)
                return
        }</span>
        <span class="cov0" title="0">io.WriteString(w, `{"message" : "Can’t update bill"}`)</span>
}

func (a *ApiDB)DeleteBill(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{
        w.Header().Add("Content-Type", "application/json")

        vars := mux.Vars(r)
        idbill, err := strconv.Atoi(vars["id"])

        if err != nil </span><span class="cov0" title="0">{
                //w.WriteHeader(http.StatusBadRequest)
                io.WriteString(w, `{"message":"can not convert id as int"}`)

                return
        }</span>

        <span class="cov0" title="0">res, _ := BUSINESS.DeleteBill(a.Db,idbill)

        if res </span><span class="cov0" title="0">{
                io.WriteString(w, `{
                                                "status": 200,
                                                "message": "Delete bill success",
                                                "data": {
                                                        "status": 1
                                                        }
                                                }`)
                return
        }</span>
        <span class="cov0" title="0">io.WriteString(w, `{"message" : "Can’t delete bill"}`)</span>
}

func (a *ApiDB) GetBillsbyblock(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{

        type Data struct {
                Bills []MODELS.BILLS `json:"bills"`
        }

        w.Header().Add("Content-Type", "application/json")
        vars := mux.Vars(r)
        idBlock, err := strconv.Atoi(vars["id"])

        if err != nil </span><span class="cov0" title="0">{
                io.WriteString(w, `{"message":"can not convert id as int"}`)
                return
        }</span>
        <span class="cov0" title="0">bill, ok, errget := BUSINESS.GetBillByIdblock(a.Db, idBlock)
        if ok != true || errget != nil </span><span class="cov0" title="0">{
                io.WriteString(w, `{ "message": "Can’t get contracts" }`)
                return
        }</span>

        <span class="cov0" title="0">res := MODELS.RespondOk{
                Status:  200,
                Message: "ok",
                Data:    Data{bill},
        }
        jsonresult, errjson := json.Marshal(res)
        if errjson != nil </span><span class="cov0" title="0">{
                log.Print("err while convert json :", err.Error())
        }</span>

        <span class="cov0" title="0">io.WriteString(w, string(jsonresult))</span>
}
</pre>
		
		<pre class="file" id="file2" style="display: none">package CONTROLLERS

import (
        "ROOMS/BUSINESS"
        "ROOMS/MODELS"
        "encoding/json"
        "io"
        "net/http"
        "strconv"

        "github.com/gorilla/mux"
)

func (a *ApiDB) GetBlock(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{
        w.Header().Add("Content-Type", "application/json")
        keys, ok := r.URL.Query()["userId"]
        if !ok || len(keys[0]) &lt; 1 </span><span class="cov0" title="0">{
                io.WriteString(w, `{ "message": "Url Param 'userid' is missing"}`)
                return
        }</span>
        <span class="cov0" title="0">idowner, _ := strconv.Atoi(keys[0])
        listBlock := BUSINESS.GetBlockByIdOwner(a.Db, idowner)
        jsonlist, _ := json.Marshal(listBlock)
        if len(listBlock) == 0 </span><span class="cov0" title="0">{
                io.WriteString(w, `{"status": 200,
                                    "message": "Get Blocks success",
                                    "data": {
                                "blocks": [] }}`)
                return
        }</span>
        <span class="cov0" title="0">stringresult := `{"status": 200,
                                    "message": "Get Blocks success",
                                    "data": {
                                "blocks":`
        stringresult += string(jsonlist)
        stringresult += "}}"
        io.WriteString(w, stringresult)</span>
}

func(a *ApiDB) GetBlockById(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{
        w.Header().Add("Content-Type", "application/json")
        vars := mux.Vars(r)
        id, err := strconv.Atoi(vars["id"])
        if err != nil </span><span class="cov0" title="0">{
                //w.WriteHeader(http.StatusBadRequest)
                io.WriteString(w, `{"message":"can not convert idowner as int"}`)
                return
        }</span>
        <span class="cov0" title="0">listBlock, OK := BUSINESS.GetBlockById(a.Db,id)
        jsonlist, _ := json.Marshal(listBlock)
        if !OK </span><span class="cov0" title="0">{
                io.WriteString(w, `{ "message": "Can’t get Blocks" }`)
                return
        }</span>
        <span class="cov0" title="0">stringresult := `{"status": 200,
                                    "message": "Get Blocks success",
                                    "data": {
                                "blocks":`
        stringresult += string(jsonlist)
        stringresult += "}}"
        io.WriteString(w, stringresult)</span>
}

func (a *ApiDB)CreateBlock(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{
        w.Header().Add("Content-Type", "application/json")
        p := MODELS.BLOCKS{}
        err := json.NewDecoder(r.Body).Decode(&amp;p)
        if err != nil </span><span class="cov0" title="0">{
                io.WriteString(w, `{"message": "wrong format!"}`+err.Error())
                return
        }</span>

        <span class="cov0" title="0">result, _ := BUSINESS.CreateBlock(a.Db,p)
        if result </span><span class="cov0" title="0">{
                io.WriteString(w, `{ "status": 200,
                                                    "message": "Create block success",
                                                            "data": {
                                                        "status": 1
                                                                            }
                                                                }`)
        }</span> else<span class="cov0" title="0"> {
                io.WriteString(w, `{ "message": "Can’t create block "}`)
        }</span>
}

func(a *ApiDB) UpdateBlock(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{
        w.Header().Add("Content-Type", "application/json")
        vars := mux.Vars(r)
        idblock, err := strconv.Atoi(vars["id"])
        if err != nil </span><span class="cov0" title="0">{
                //w.WriteHeader(http.StatusBadRequest)
                io.WriteString(w, `{"message":"can not convert id as int"}`)
                return
        }</span>
        <span class="cov0" title="0">p := MODELS.BLOCKS{}
        err1 := json.NewDecoder(r.Body).Decode(&amp;p)
        if err1 != nil </span><span class="cov0" title="0">{
                io.WriteString(w, `{"message": "wrong format!"}`+err.Error())
                return
        }</span>
        <span class="cov0" title="0">p.Id = idblock
        hasroweffected, _ := BUSINESS.UpdateBlock(a.Db,p)
        if hasroweffected == false </span><span class="cov0" title="0">{
                io.WriteString(w, `{ "message": "Can’t update block" }`)
                return
        }</span>
        <span class="cov0" title="0">stringresult := `{  "status": 200,
                                            "message": "Update Success",
                                                "data": {
                                                        "status": 1
                                                            }
                                                }`
        io.WriteString(w, stringresult)
        return</span>
}

func (a *ApiDB)DeleteBlock(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{
        w.Header().Add("Content-Type", "application/json")
        w.Header().Set("Access-Control-Allow-Origin", "*")
        w.Header().Set("Access-Control-Allow-Methods", "POST, GET, OPTIONS, PUT, DELETE")
        w.Header().Set("Access-Control-Allow-Headers",
                "Accept, Content-Type, Content-Length, Accept-Encoding, X-CSRF-Token, Authorization")

        vars := mux.Vars(r)
        idblock, err := strconv.Atoi(vars["id"])

        if err != nil </span><span class="cov0" title="0">{
                //w.WriteHeader(http.StatusBadRequest)
                io.WriteString(w, `{"message":"can not convert id as int"}`)

                return
        }</span>

        <span class="cov0" title="0">res, _ := BUSINESS.DeleteBlock(a.Db,idblock)

        if res </span><span class="cov0" title="0">{
                io.WriteString(w, `{
                                                "status": 200,
                                                "message": "Delete Block success",
                                                "data": {
                                                        "status": 1
                                                        }
                                                }`)
                return
        }</span>
        <span class="cov0" title="0">io.WriteString(w, `{"message" : "Can’t  Delete Block"}`)</span>
}

func (a *ApiDB)DeleteBlocks(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{
        w.Header().Add("Content-Type", "application/json")

        var p = MODELS.IDBLOCKS{}
        err := json.NewDecoder(r.Body).Decode(&amp;p)

        if err != nil </span><span class="cov0" title="0">{
                io.WriteString(w, `{ "message": "Wrong format" }`)
                return
        }</span>
        <span class="cov0" title="0">res, _ := BUSINESS.DeleteBlocks(a.Db,p.BlocksId)

        if res </span><span class="cov0" title="0">{
                io.WriteString(w, `{
                                                "status": 200,
                                                "message": "Delete Block success",
                                                "data": {
                                                        "status": 1
                                                        }
                                                }`)
                return
        }</span>
        <span class="cov0" title="0">io.WriteString(w, `{"message" : "Can’t  Delete Block"}`)</span>
}
</pre>
		
		<pre class="file" id="file3" style="display: none">package CONTROLLERS

import (
        "ROOMS/BUSINESS"
        "ROOMS/MODELS"
        "encoding/json"
        "github.com/gorilla/mux"
        "io"
        "net/http"
        "strconv"
)

func (a *ApiDB)GetContract(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{
        w.Header().Add("Content-Type", "application/json")
        keys, ok := r.URL.Query()["idBlock"]
        if !ok || len(keys[0]) &lt; 1 </span><span class="cov0" title="0">{
                io.WriteString(w, `{"message":"can not convert idBlock as int"}`)
                return
        }</span>
        <span class="cov0" title="0">BlockId, _ := strconv.Atoi(keys[0])
        listCustomer, _, err := BUSINESS.GetContractByBlockId(a.Db,BlockId)
        jsonCustomers, _ := json.Marshal(listCustomer)

        if err != nil </span><span class="cov0" title="0">{
                io.WriteString(w, `{ "message": "Can’t get contracts" }`)
                return
        }</span>

        <span class="cov0" title="0">stringresult := `{"status": 200,
                                    "message": "Get contracts success redis",
                                    "data": {
                                "contracts":`
        stringresult += string(jsonCustomers)
        stringresult += "}}"
        io.WriteString(w, stringresult)</span>
}

func (a *ApiDB)CreateContract(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{
        w.Header().Add("Content-Type", "application/json")
        p := MODELS.CREATE_UPDATE_CONTRACT_REQUEST{}
        err := json.NewDecoder(r.Body).Decode(&amp;p)
        if err != nil </span><span class="cov0" title="0">{
                io.WriteString(w, `{"message": "wrong format!"}`+err.Error())
                return
        }</span>

        <span class="cov0" title="0">result := BUSINESS.CreateContract(a.Db,p)
        if result </span><span class="cov0" title="0">{
                io.WriteString(w, `  { "status": 200,
    "message": "Create contract success",
    "data": {
        "status": 1
    }
}
`)
        }</span> else<span class="cov0" title="0"> {
                io.WriteString(w, `{ "message": "Can’t create contract"}`)
        }</span>
}

func (a *ApiDB)DeleteContract(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{
        w.Header().Add("Content-Type", "application/json")

        vars := mux.Vars(r)
        idContract, err := strconv.Atoi(vars["id"])

        if err != nil </span><span class="cov0" title="0">{
                //w.WriteHeader(http.StatusBadRequest)
                io.WriteString(w, `{"message":"can not convert id as int"}`)

                return
        }</span>

        <span class="cov0" title="0">res, _ := BUSINESS.DeleteContract(a.Db,idContract)

        if res </span><span class="cov0" title="0">{
                io.WriteString(w, `{
                                                "status": 200,
                                                "message": "Delete contract success",
                                                "data": {
                                                        "status": 1
                                                        }
                                                }`)
                return
        }</span>
        <span class="cov0" title="0">io.WriteString(w, `{"message" : "Can’t delete contract"}`)</span>
}

func (a *ApiDB)DeleteAllContract(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{
        w.Header().Add("Content-Type", "application/json")

        type arrcontractId struct {
                ContractsId []int `json:"contractsId"`
        }
        p := arrcontractId{}
        err := json.NewDecoder(r.Body).Decode(&amp;p)
        if err != nil </span><span class="cov0" title="0">{
                io.WriteString(w, `{"message": "wrong format!"}`)
                return
        }</span>

        <span class="cov0" title="0">if err != nil </span><span class="cov0" title="0">{
                //w.WriteHeader(http.StatusBadRequest)
                io.WriteString(w, `{"message":"can not convert id as int"}`)

                return
        }</span>

        <span class="cov0" title="0">res, _ := BUSINESS.DeleteAllContract(a.Db,p.ContractsId)

        if res </span><span class="cov0" title="0">{
                io.WriteString(w, `{
                                                "status": 200,
                                                "message": "Delete contract success",
                                                "data": {
                                                        "status": 1
                                                        }
                                                }`)
                return
        }</span>
        <span class="cov0" title="0">io.WriteString(w, `{"message" : "Can’t delete contract"}`)</span>
}

func (a *ApiDB)UpdateContract(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{
        w.Header().Add("Content-Type", "application/json")

        vars := mux.Vars(r)
        idContract, _ := strconv.Atoi(vars["id"])

        var p = MODELS.CREATE_UPDATE_CONTRACT_REQUEST{}

        err := json.NewDecoder(r.Body).Decode(&amp;p)
        if err != nil </span><span class="cov0" title="0">{
                io.WriteString(w, `{ "message": "Wrong format" }`)
                return
        }</span>

        <span class="cov0" title="0">p.Id = idContract
        res, _ := BUSINESS.UpdateContract(a.Db,p)

        if res </span><span class="cov0" title="0">{
                io.WriteString(w, `{
                                                "status": 200,
                                                "message": "Update contracts success",
                                                "data": {
                                                        "status": 1
                                                        }
                                                }`)
                return
        }</span>
        <span class="cov0" title="0">io.WriteString(w, `{"message" : "Can’t update contracts"}`)</span>
}
</pre>
		
		<pre class="file" id="file4" style="display: none">package CONTROLLERS

import (
        "ROOMS/BUSINESS"
        "ROOMS/MODELS"
        "encoding/json"
        "github.com/gorilla/mux"
        "io"
        "net/http"
        "strconv"
)

func (a *ApiDB)GetCustomersByUserId(w http.ResponseWriter, r *http.Request)  <span class="cov0" title="0">{
        w.Header().Add("Content-Type","application/json")
        keys, ok := r.URL.Query()["userId"]
        if !ok || len(keys[0]) &lt; 1 </span><span class="cov0" title="0">{
                io.WriteString(w, `{"message":"can not convert idowner as int"}`)
                return
        }</span>
        <span class="cov0" title="0">userId, _ := strconv.Atoi(keys[0])
        listCustomer, _, err := BUSINESS.GetCustomersByUserId(a.Db,userId)
        jsonCustomers, _ := json.Marshal(listCustomer)

        if err != nil</span><span class="cov0" title="0">{
                io.WriteString(w, `{ "message": "Can’t get customers" }`)
                return
        }</span>

        <span class="cov0" title="0">stringresult := `{"status": 200,
                                    "message": "Get customers success",
                                    "data": {
                                "customers":`
        stringresult += string(jsonCustomers)
        stringresult += "}}"
        io.WriteString(w, stringresult)</span>
}

func (a *ApiDB)CreateCustomer(w http.ResponseWriter, r *http.Request)  <span class="cov0" title="0">{
        w.Header().Add("Content-Type","application/json")

        p := MODELS.CUSTOMER_INPUT{}
        err := json.NewDecoder(r.Body).Decode(&amp;p)

        if err != nil</span><span class="cov0" title="0">{
                io.WriteString(w, `{"message": "wrong format!"}` + err.Error())
                return
        }</span>

        <span class="cov0" title="0">rs, _ := BUSINESS.CreateCustomer(a.Db,p)

        if rs </span><span class="cov0" title="0">{
                io.WriteString(w, `{ "status": 200,
                                                    "message": "Create customer success",
                                                            "data": {
                                                        "status": 1
                                                                            }
                                                                }`)
        }</span> else<span class="cov0" title="0"> {
                io.WriteString(w, `{ "message": "Can’t create customer "}`)
        }</span>
}

func (a *ApiDB)DeleteCustomer(w http.ResponseWriter, r *http.Request)  <span class="cov0" title="0">{
        w.Header().Add("Content-Type", "application/json")
        w.Header().Set("Access-Control-Allow-Origin", "*")
        w.Header().Set("Access-Control-Allow-Methods", "POST, GET, OPTIONS, PUT, DELETE")
        w.Header().Set("Access-Control-Allow-Headers",
                "Accept, Content-Type, Content-Length, Accept-Encoding, X-CSRF-Token, Authorization")

        vars := mux.Vars(r)
        idCustomer, err := strconv.Atoi(vars["id"])

        if err != nil </span><span class="cov0" title="0">{
                //w.WriteHeader(http.StatusBadRequest)
                io.WriteString(w, `{"message":"can not convert id as int"}`)

                return
        }</span>

        <span class="cov0" title="0">res, _ := BUSINESS.DeleteCustomer(a.Db,idCustomer)

        if res </span><span class="cov0" title="0">{
                io.WriteString(w, `{
                                                "status": 200,
                                                "message": "Delete customer success",
                                                "data": {
                                                        "status": 1
                                                        }
                                                }`)
                return
        }</span>
        <span class="cov0" title="0">io.WriteString(w, `{"message" : "Can’t delete customer"}`)</span>
}

func (a *ApiDB)DeleteManyCustomers(w http.ResponseWriter, r *http.Request)  <span class="cov0" title="0">{
        w.Header().Add("Content-Type", "application/json")

        var p = MODELS.CUSTOMERIDS{}
        err := json.NewDecoder(r.Body).Decode(&amp;p)

        if err != nil </span><span class="cov0" title="0">{
                io.WriteString(w, `{ "message": "Wrong format" }`)
                return
        }</span>
        <span class="cov0" title="0">res, _ := BUSINESS.DeleteManyCustomers(a.Db,p.CustomersId)

        if res </span><span class="cov0" title="0">{
                io.WriteString(w, `{
                                                "status": 200,
                                                "message": "Delete customers success",
                                                "data": {
                                                        "status": 1
                                                        }
                                                }`)
                return
        }</span>
        <span class="cov0" title="0">io.WriteString(w, `{"message" : "Can’t  delete customers"}`)</span>
}

func (a *ApiDB)UpdateCustomer(w http.ResponseWriter, r *http.Request)  <span class="cov0" title="0">{
        w.Header().Add("Content-Type", "application/json")

        vars := mux.Vars(r)
        idCustomer, err := strconv.Atoi(vars["id"])
        if err != nil </span><span class="cov0" title="0">{
                io.WriteString(w, `{"message":"can not convert id as int"}`)
                return
        }</span>

        <span class="cov0" title="0">p := MODELS.CUSTOMER_UPDATE{}
        err1 := json.NewDecoder(r.Body).Decode(&amp;p)
        if err1 != nil </span><span class="cov0" title="0">{
                io.WriteString(w, `{"message": "wrong format!"}`+err1.Error())
                return
        }</span>
        <span class="cov0" title="0">p.Id = idCustomer
        hasroweffected, _ := BUSINESS.UpdateCustomer(a.Db,p)
        if hasroweffected == false </span><span class="cov0" title="0">{
                io.WriteString(w, `{ "message": "Can’t update customer" }`)
                return
        }</span>
        <span class="cov0" title="0">stringresult := `{  "status": 200,
                                            "message": "Update customer Success",
                                                "data": {
                                                        "status": 1
                                                            }
                                                }`
        io.WriteString(w, stringresult)
        return</span>
}</pre>
		
		<pre class="file" id="file5" style="display: none">package CONTROLLERS

import (
        "fmt"
        r "gopkg.in/redis.v5"
        "net/http"
        "net/http/httptest"
        "regexp"
        "strings"
        "time"
)

var preffix = "_PAGE_CACHE_"

//Storage mecanism for caching strings in memory
type Storage struct {
        client *r.Client
}

//NewStorage creates a new redis storage
func NewStorage(url string) (*Storage, error) <span class="cov0" title="0">{
        var (
                opts *r.Options
                err  error
        )

        if opts, err = r.ParseURL(url); err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov0" title="0">return &amp;Storage{
                client: r.NewClient(opts),
        }, nil</span>
}

//Get a cached content by key
func (s Storage) Get(key string) []byte <span class="cov0" title="0">{
        val, _ := s.client.Get(preffix + key).Bytes()
        return val
}</span>

//Set a cached content by key
func (s Storage) Set(key string, content []byte, duration time.Duration) <span class="cov0" title="0">{
        s.client.Set(preffix+key, content, duration)
}</span>

//Only use to Get Method
func Cached(storage *Storage, duration string, handler func(w http.ResponseWriter, r *http.Request)) http.Handler <span class="cov0" title="0">{
        return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) </span><span class="cov0" title="0">{
                w.Header().Add("Content-Type", "application/json")

                re := regexp.MustCompile(`token=(\w*)\.(\w*).(\w*)`)
                negString := string(re.Find([]byte(r.RequestURI)))
                Key := strings.Replace(r.RequestURI, negString, "", 1)

                content := storage.Get(Key)
                if content != nil </span><span class="cov0" title="0">{
                        fmt.Print("Cache Hit!\n")
                        w.Write(content)
                }</span> else<span class="cov0" title="0"> {
                        c := httptest.NewRecorder()
                        handler(c, r)

                        for k, v := range c.HeaderMap </span><span class="cov0" title="0">{
                                w.Header()[k] = v
                        }</span>

                        <span class="cov0" title="0">w.WriteHeader(c.Code)
                        content := c.Body.Bytes()

                        if d, err := time.ParseDuration(duration); err == nil </span><span class="cov0" title="0">{
                                fmt.Printf("New page cached: %s for %s\n", Key, duration)
                                storage.Set(Key, content, d)
                        }</span> else<span class="cov0" title="0"> {
                                fmt.Printf("Page not cached. err: %s\n", err)
                        }</span>

                        <span class="cov0" title="0">w.Write(content)</span>
                }

        })
}
</pre>
		
		<pre class="file" id="file6" style="display: none">package CONTROLLERS

import (
        "ROOMS/BUSINESS"
        "encoding/json"
        "io"
        "net/http"
)

func (a *ApiDB) Get_default_service(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{
        w.Header().Add("Content-Type", "application/json")

        listUnit, Ok := BUSINESS.Get_all_default_service(a.Db)
        jsonlist, _ := json.Marshal(listUnit)
        if !Ok </span><span class="cov0" title="0">{
                io.WriteString(w, `{ "message": "Can’t get units" }`)
                return
        }</span>
        <span class="cov0" title="0">stringresult := `{"status": 200,
                                    "message": "Get services success",
                                    "data": {
                                "defaultServices":`
        stringresult += string(jsonlist)
        stringresult += "}}"
        io.WriteString(w, stringresult)</span>
}
</pre>
		
		<pre class="file" id="file7" style="display: none">package CONTROLLERS

import (
        "database/sql"
        "github.com/gorilla/mux"
        "net/http"
)

type ApiDB struct {
        Db *sql.DB
}

func InitAllController(a ApiDB, r *mux.Router, storage *Storage) <span class="cov0" title="0">{

        //UsersController
        r.HandleFunc("/user/login", a.UserLogin).Methods("POST")
        r.HandleFunc("/user/register", a.UserRegister).Methods("POST")
        r.Handle("/user/get-all-username", Cached(storage, "10s", a.GetallUserName)).Methods("GET")
        r.Handle("/user/validate", AuthMiddleware(http.HandlerFunc(ValidateToken))).Methods("POST")
        r.Handle("/user/get-user", AuthMiddleware(Cached(storage, "10s", a.GetUser))).Methods("GET")
        r.Handle("/user/get-user/{Id}", AuthMiddleware(Cached(storage, "10s", a.GetUser))).Methods("GET")

        //BlocksController
        r.Handle("/block/get-block/{id}", AuthMiddleware(Cached(storage, "10s", a.GetBlockById))).Methods("GET")
        r.Handle("/block/get-block", AuthMiddleware(Cached(storage, "10s", a.GetBlock))).Methods("GET")
        r.Handle("/block/create", AuthMiddleware(http.HandlerFunc(a.CreateBlock))).Methods("POST")
        r.Handle("/block/update/{id}", AuthMiddleware(http.HandlerFunc(a.UpdateBlock))).Methods("PUT")
        r.Handle("/block/delete/{id}", AuthMiddleware(http.HandlerFunc(a.DeleteBlock))).Methods("DELETE")
        r.Handle("/block/delete-all", AuthMiddleware(http.HandlerFunc(a.DeleteBlocks))).Methods("POST")

        //RoomController
        r.Handle("/room/get-rooms", AuthMiddleware(Cached(storage, "10s", a.GetRoom))).Methods("GET")
        r.Handle("/room/get-rooms/{id}", AuthMiddleware(Cached(storage, "10s", a.GetRoom))).Methods("GET")
        r.Handle("/room/get-rooms-dashboard", AuthMiddleware(Cached(storage, "10s", a.GetRoomDB))).Methods("GET")
        r.Handle("/room/get-images", AuthMiddleware(Cached(storage, "10s", a.GetRoomImage))).Methods("GET")
        r.Handle("/room/get-user-rent", AuthMiddleware(Cached(storage, "10s", a.GetRoomUser))).Methods("GET")
        r.Handle("/room/create", AuthMiddleware(http.HandlerFunc(a.CreateRoom))).Methods("POST")
        r.Handle("/room/delete/{id}", AuthMiddleware(http.HandlerFunc(a.DeleteRoom))).Methods("DELETE")
        r.Handle("/room/delete-all", AuthMiddleware(http.HandlerFunc(a.DeleteRooms))).Methods("POST")
        r.Handle("/room/update/{id}", AuthMiddleware(http.HandlerFunc(a.UpdateRoom))).Methods("PUT")

        //UnitController
        r.Handle("/unit/get-units", AuthMiddleware(Cached(storage, "10s", a.GetAllUnit))).Methods("GET")

        //DefaultServiceController
        r.Handle("/default-service/get-default-services", AuthMiddleware(Cached(storage, "10s", a.Get_default_service))).Methods("GET")

        //ServiceController
        r.Handle("/service/get-services", AuthMiddleware(Cached(storage, "10s", a.GetService))).Methods("GET")
        r.Handle("/service/delete/{id}", AuthMiddleware(http.HandlerFunc(a.DeleteService))).Methods("DELETE")
        r.Handle("/service/create", AuthMiddleware(http.HandlerFunc(a.CreateService))).Methods("POST")
        r.Handle("/service/delete-all", AuthMiddleware(http.HandlerFunc(a.DeleteServices))).Methods("POST")
        r.Handle("/service/update/{id}", AuthMiddleware(http.HandlerFunc(a.UpdateService))).Methods("PUT")

        //uploadFile
        r.HandleFunc("/upload/userAvatar", UploadPicture).Methods("POST")

        //CustomerController
        r.Handle("/customer/get-customers", AuthMiddleware(http.HandlerFunc(a.GetCustomersByUserId))).Methods("GET")
        r.Handle("/customer/create", AuthMiddleware(http.HandlerFunc(a.CreateCustomer))).Methods("POST")
        r.Handle("/customer/delete/{id}", AuthMiddleware(http.HandlerFunc(a.DeleteCustomer))).Methods("DELETE")
        r.Handle("/customer/delete-all", AuthMiddleware(http.HandlerFunc(a.DeleteManyCustomers))).Methods("POST")
        r.Handle("/customer/update/{id}", AuthMiddleware(http.HandlerFunc(a.UpdateCustomer))).Methods("PUT")

        //ContractController
        r.Handle("/contract/get-contracts", AuthMiddleware(http.HandlerFunc(a.GetContract))).Methods("GET")
        r.Handle("/contract/create", AuthMiddleware(http.HandlerFunc(a.CreateContract))).Methods("POST")
        r.Handle("/contract/delete/{id}", AuthMiddleware(http.HandlerFunc(a.DeleteContract))).Methods("DELETE")
        r.Handle("/contract/delete-all", AuthMiddleware(http.HandlerFunc(a.DeleteAllContract))).Methods("POST")
        r.Handle("/contract/update/{id}", AuthMiddleware(http.HandlerFunc(a.UpdateContract))).Methods("PUT")

        //BillControllers
        r.Handle("/bill/get-bills/{id}", AuthMiddleware(http.HandlerFunc(a.GetBillsbyblock))).Methods("GET")
        r.Handle("/bill/get-bill-by-id/{id}", AuthMiddleware(http.HandlerFunc(a.GetBills))).Methods("GET")
        r.Handle("/bill/create", AuthMiddleware(http.HandlerFunc(a.CreateBill))).Methods("POST")
        r.Handle("/bill/delete/{id}", AuthMiddleware(http.HandlerFunc(a.DeleteBill))).Methods("DELETE")
        //r.Handle("/contract/delete-all", AuthMiddleware(http.HandlerFunc(DeleteAllContract))).Methods("POST")
        r.Handle("/bill/update/{id}", AuthMiddleware(http.HandlerFunc(a.UpdateBill))).Methods("PUT")
}</span>
</pre>
		
		<pre class="file" id="file8" style="display: none">package CONTROLLERS

import (
        "ROOMS/BUSINESS"
        "ROOMS/MODELS"
        "encoding/json"
        "io"
        "log"
        "net/http"
        "strconv"

        "github.com/gorilla/mux"
)

func (a *ApiDB) GetRoom(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{
        w.Header().Add("Content-Type", "application/json")
        vars := mux.Vars(r)
        id, err := strconv.Atoi(vars["id"])
        if err == nil &amp;&amp; id &gt; 0 </span><span class="cov0" title="0">{
                result, bool := BUSINESS.GetRoomById(a.Db, id)
                resultJson, _ := json.Marshal(result)
                var data string
                if bool == nil &amp;&amp; result != nil </span><span class="cov0" title="0">{
                        data = `{                "status": 200,
                                        "message": "Get rooms success",
                                        "data":
                                                {"room":`

                        if len(resultJson) &gt; 0 </span><span class="cov0" title="0">{
                                data += string(resultJson)
                        }</span> else<span class="cov0" title="0"> {
                                data += "[]"
                        }</span>

                        <span class="cov0" title="0">data += `}}`</span>
                } else<span class="cov0" title="0"> {
                        data = `{"message": "Can’t get room"}`
                }</span>
                <span class="cov0" title="0">io.WriteString(w, data)
                return</span>
        } else<span class="cov0" title="0"> {
                idBlockP, ok := r.URL.Query()["idBlock"]
                if !ok || len(idBlockP[0]) &lt; 1 </span><span class="cov0" title="0">{
                        io.WriteString(w, `{ "message": "Url Param 'idBlock' is missing"}`)
                        return
                }</span>
                <span class="cov0" title="0">idBlock, err := strconv.Atoi(idBlockP[0])
                if err != nil </span><span class="cov0" title="0">{
                        io.WriteString(w, `{"message": "Wrong format!"}`)
                        return
                }</span>
                <span class="cov0" title="0">if err := r.ParseForm(); err != nil </span><span class="cov0" title="0">{
                        log.Printf("Error parsing form: %s", err)
                        return
                }</span>
                <span class="cov0" title="0">isMatchP, err := strconv.ParseBool(r.Form.Get("isMatch"))

                if isMatchP </span><span class="cov0" title="0">{
                        result, bool, _ := BUSINESS.UpdateGetRoom(a.Db, idBlock)
                        resultJson, _ := json.Marshal(result)

                        data := `{                "status": 200,
                                        "message": "Get rooms success",
                                        "data":
                                                {"rooms":`
                        if len(result) &gt; 0 </span><span class="cov0" title="0">{
                                data += string(resultJson)
                        }</span> else<span class="cov0" title="0"> {
                                data += "[]"
                        }</span>
                        <span class="cov0" title="0">data += `}}`

                        if bool </span><span class="cov0" title="0">{
                                io.WriteString(w, data)
                        }</span>
                } else<span class="cov0" title="0"> {
                        result, bool, _ := BUSINESS.GetRoom(a.Db, idBlock)
                        resultJson, _ := json.Marshal(result)

                        data := `{                "status": 200,
                                        "message": "Get rooms success",
                                        "data":
                                                {"rooms":`
                        if len(result) &gt; 0 </span><span class="cov0" title="0">{
                                data += string(resultJson)
                        }</span> else<span class="cov0" title="0"> {
                                data += "[]"
                        }</span>
                        <span class="cov0" title="0">data += `}}`

                        if bool </span><span class="cov0" title="0">{
                                io.WriteString(w, data)
                        }</span>
                }
        }
}

func (a *ApiDB) CreateRoom(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{
        w.Header().Add("Content-Type", "application/json")

        room := MODELS.ROOMS{}
        err := json.NewDecoder(r.Body).Decode(&amp;room)

        if err != nil </span><span class="cov0" title="0">{
                io.WriteString(w, `{"message": "Wrong format!"}`)
                return
        }</span>

        <span class="cov0" title="0">result, err := BUSINESS.CreateRoom(a.Db, room)
        if result </span><span class="cov0" title="0">{
                io.WriteString(w, `{
                                                "status": 200,
                                                "message": "Create rooms success",
                                                "data": {
                                                        "status": 1
                                                        }
                                                }`)
        }</span> else<span class="cov0" title="0"> {
                io.WriteString(w, `{"message" : "Can't create room'"}`)
        }</span>
}

func (a *ApiDB) DeleteRoom(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{
        w.Header().Add("Content-Type", "application/json")
        w.Header().Set("Access-Control-Allow-Origin", "*")
        w.Header().Set("Access-Control-Allow-Methods", "POST, GET, OPTIONS, PUT, DELETE")
        w.Header().Set("Access-Control-Allow-Headers",
                "Accept, Content-Type, Content-Length, Accept-Encoding, X-CSRF-Token, Authorization")

        vars := mux.Vars(r)
        id, err := strconv.Atoi(vars["id"])

        if err != nil </span><span class="cov0" title="0">{
                io.WriteString(w, `{"message": "Wrong format!"}`)
                return
        }</span>

        <span class="cov0" title="0">result, err := BUSINESS.DeleteRoom(a.Db, id)

        if result </span><span class="cov0" title="0">{
                io.WriteString(w, `{ 
                                                                "status": 200,
                                                                "message": "Delete rooms success",
                                                                "data": {
                                                                        "status": 1
                                                                }}`)
        }</span> else<span class="cov0" title="0"> {
                io.WriteString(w, `"message": "Can’t delete room"`)
        }</span>
}

func (a *ApiDB) DeleteRooms(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{
        w.Header().Add("Content-Type", "application/json")

        var ids = MODELS.ROOMIDS{}
        err := json.NewDecoder(r.Body).Decode(&amp;ids)

        if err != nil </span><span class="cov0" title="0">{
                io.WriteString(w, "Wrong format !")
                return
        }</span>

        <span class="cov0" title="0">result, _ := BUSINESS.DeleteRooms(a.Db, ids.RoomsId)

        if result </span><span class="cov0" title="0">{
                io.WriteString(w, `{
                                                                "status": 200,
                                                                "message": "Delete rooms success",
                                                                "data": {
                                                                        "status": 1
                                                                }
                                                        }`)
        }</span> else<span class="cov0" title="0"> {
                io.WriteString(w, `{"message": "Can’t delete rooms"}`)
        }</span>
}

func (a *ApiDB) UpdateRoom(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{
        w.Header().Add("Content-Type", "application/json")

        vars := mux.Vars(r)
        id, err := strconv.Atoi(vars["id"])

        room := MODELS.ROOMS{}
        arr2 := json.NewDecoder(r.Body).Decode(&amp;room)

        if err != nil || arr2 != nil </span><span class="cov0" title="0">{
                io.WriteString(w, `{"message": "Wrong format!"}`)
                return
        }</span>

        <span class="cov0" title="0">result, err := BUSINESS.UpdateRoom(a.Db, id, room)

        if result </span><span class="cov0" title="0">{
                io.WriteString(w, `{  "status": 200,
                                                                "message": "Update room success",
                                                                "data": {
                                                                "status": 1
                                                                }}`)
        }</span> else<span class="cov0" title="0"> {
                io.WriteString(w, `{"message": "Can’t update room"}`)
        }</span>
}

func (a *ApiDB) GetRoomDB(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{
        w.Header().Add("Content-Type", "application/json")
        status, ok := r.URL.Query()["status"]
        idBlock, ok1 := r.URL.Query()["idBlock"]
        userId, ok2 := r.URL.Query()["userId"]
        if !ok1 || len(idBlock[0]) &lt; 1 </span><span class="cov0" title="0">{
                io.WriteString(w, `{ "message": "Url Param 'idBlock' is missing"}`)
                return
        }</span>
        <span class="cov0" title="0">if !ok || len(status[0]) &lt; 1 </span><span class="cov0" title="0">{
                io.WriteString(w, `{ "message": "Url Param 'status' is missing"}`)
                return
        }</span>
        <span class="cov0" title="0">if !ok2 || len(userId[0]) &lt; 1 </span><span class="cov0" title="0">{
                io.WriteString(w, `{ "message": "Url Param 'userId' is missing"}`)
                return
        }</span>

        <span class="cov0" title="0">IdBlock, err := strconv.Atoi(idBlock[0])
        Status, err1 := strconv.Atoi(status[0])
        UserId, err2 := strconv.Atoi(userId[0])

        if err != nil || err1 != nil || err2 != nil </span><span class="cov0" title="0">{
                io.WriteString(w, `{"message": "Wrong format!"}`)
                return
        }</span>

        <span class="cov0" title="0">result, err := BUSINESS.GetRoomDB(a.Db, IdBlock, Status, UserId)
        resultJson, _ := json.Marshal(result)
        if err != nil </span><span class="cov0" title="0">{
                io.WriteString(w, `{"message": "Can’t get rooms"}`)
        }</span>
        <span class="cov0" title="0">data := `{                "status": 200,
                                        "message": "Get rooms success",
                                        "data":
                                                {"rooms":`
        data += string(resultJson)
        data += `}}`
        io.WriteString(w, data)</span>

}

func (a *ApiDB) GetRoomImage(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{
        w.Header().Add("Content-Type", "application/json")
        codeRoom, ok := r.URL.Query()["codeRoom"]
        if !ok || len(codeRoom[0]) &lt; 1 </span><span class="cov0" title="0">{
                io.WriteString(w, `{ "message": "Url Param 'idBlock' is missing"}`)
                return
        }</span>

        <span class="cov0" title="0">result, bool, _ := BUSINESS.GetRoomImage(a.Db, codeRoom[0])
        resultJson, _ := json.Marshal(result)
        var data string
        if bool </span><span class="cov0" title="0">{
                data = `{                "status": 200,
                                        "message": "Get images success",
                                        "data":
                                                {"images":`
                if len(result) &gt; 0 </span><span class="cov0" title="0">{
                        data += string(resultJson)
                }</span> else<span class="cov0" title="0"> {
                        data += "[]"
                }</span>

                <span class="cov0" title="0">data += `}}`</span>

        } else<span class="cov0" title="0"> {
                data = `{    "message": "Can’t get images",}`

        }</span>
        <span class="cov0" title="0">io.WriteString(w, data)</span>

}

func (a *ApiDB) GetRoomUser(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{
        w.Header().Add("Content-Type", "application/json")
        idRooms, ok := r.URL.Query()["idRoom"]
        if !ok || len(idRooms[0]) &lt; 1 </span><span class="cov0" title="0">{
                io.WriteString(w, `{ "message": "Url Param 'idRoom' is missing"}`)
                return
        }</span>
        <span class="cov0" title="0">IdRoom, err := strconv.Atoi(idRooms[0])
        if err != nil </span><span class="cov0" title="0">{
                io.WriteString(w, `{ "message": "can not parse idRoom as int"}`)
                return
        }</span>
        <span class="cov0" title="0">result, bool, _ := BUSINESS.GetUserRenting(a.Db, IdRoom)
        resultJson, _ := json.Marshal(result)
        var data string
        if bool </span><span class="cov0" title="0">{
                data = `{                "status": 200,
                                        "message": "Get user rent success",
                                        "data":
                                                {"userRents":`
                if len(result) &gt; 0 </span><span class="cov0" title="0">{
                        data += string(resultJson)
                }</span> else<span class="cov0" title="0"> {
                        data += "[]"
                }</span>
                <span class="cov0" title="0">data += `}}`</span>

        } else<span class="cov0" title="0"> {
                data = `{    "message": "Can’t get user rent",}`

        }</span>
        <span class="cov0" title="0">io.WriteString(w, data)</span>

}
</pre>
		
		<pre class="file" id="file9" style="display: none">package CONTROLLERS

import (
        "ROOMS/BUSINESS"
        "ROOMS/MODELS"
        "encoding/json"
        "github.com/gorilla/mux"
        "io"
        "net/http"
        "strconv"
)

func (a *ApiDB) GetService(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{
        w.Header().Add("Content-Type", "application/json")
        keys, ok := r.URL.Query()["idBlock"]
        if !ok || len(keys[0]) &lt; 1 </span><span class="cov0" title="0">{
                io.WriteString(w, "{Url Param 'idBlock' is missing")
                return
        }</span>
        <span class="cov0" title="0">idBlock, _ := strconv.Atoi(keys[0])
        listBlock, Ok := BUSINESS.GetServiceById(a.Db, idBlock)
        jsonlist, _ := json.Marshal(listBlock)
        if !Ok </span><span class="cov0" title="0">{
                io.WriteString(w, `{ "message": "Can’t get services" }`)
                return
        }</span>
        <span class="cov0" title="0">stringresult := `{"status": 200,
                                    "message": "Get services success",
                                    "data": {
                                "services":`
        stringresult += string(jsonlist)
        stringresult += "}}"
        io.WriteString(w, stringresult)</span>
}

func (a *ApiDB) DeleteService(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{
        w.Header().Add("Content-Type", "application/json")

        vars := mux.Vars(r)
        idservice, err := strconv.Atoi(vars["id"])

        if err != nil </span><span class="cov0" title="0">{
                //w.WriteHeader(http.StatusBadRequest)
                io.WriteString(w, `{"message":"can not convert id as int"}`)
                return
        }</span>

        <span class="cov0" title="0">res, _ := BUSINESS.DeleteService(a.Db, idservice)

        if res </span><span class="cov0" title="0">{
                io.WriteString(w, `{
                                                "status": 200,
                                                "message": "Delete service success",
                                                "data": {
                                                        "status": 1
                                                        }
                                                }`)
                return
        }</span>
        <span class="cov0" title="0">io.WriteString(w, `{"message" : "Can’t  delete service"}`)</span>
}

func (a *ApiDB) CreateService(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{
        w.Header().Add("Content-Type", "application/json")

        var p = MODELS.SERVICES_INPUT{}

        err := json.NewDecoder(r.Body).Decode(&amp;p)

        if err != nil </span><span class="cov0" title="0">{
                io.WriteString(w, `{ "message": "Wrong format" }`)
                return
        }</span>

        <span class="cov0" title="0">res, _ := BUSINESS.CreateService(a.Db, p.Services)
        if res </span><span class="cov0" title="0">{
                io.WriteString(w, `{
                                                "status": 200,
                                                "message": "Create Services success",
                                                "data": {
                                                        "status": 1
                                                        }
                                                }`)
                return
        }</span>
        <span class="cov0" title="0">io.WriteString(w, `{"message" : "Can’t create Services"}`)</span>
}

func (a *ApiDB) DeleteServices(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{
        w.Header().Add("Content-Type", "application/json")

        p := struct {
                ServicesId []int `json:"servicesId"`
        }{}
        err := json.NewDecoder(r.Body).Decode(&amp;p)

        if err != nil </span><span class="cov0" title="0">{
                io.WriteString(w, `{ "message": "Wrong format" }`)
                return
        }</span>
        <span class="cov0" title="0">res, _ := BUSINESS.DeleteServices(a.Db, p.ServicesId)

        if res </span><span class="cov0" title="0">{
                io.WriteString(w, `{
                                                "status": 200,
                                                "message": "Delete Services success",
                                                "data": {
                                                        "status": 1
                                                        }
                                                }`)
                return
        }</span>
        <span class="cov0" title="0">io.WriteString(w, `{"message" : "Can’t delete services"}`)</span>
}

func (a *ApiDB) UpdateService(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{
        w.Header().Add("Content-Type", "application/json")

        vars := mux.Vars(r)
        idService, _ := strconv.Atoi(vars["id"])

        var p = MODELS.SERVICE_INPUT{}

        err := json.NewDecoder(r.Body).Decode(&amp;p)
        if err != nil </span><span class="cov0" title="0">{
                io.WriteString(w, `{ "message": "Wrong format" }`)
                return
        }</span>

        <span class="cov0" title="0">p.Id = idService
        res, _ := BUSINESS.UpdateService(a.Db, p)

        if res </span><span class="cov0" title="0">{
                io.WriteString(w, `{
                                                "status": 200,
                                                "message": "Update service success",
                                                "data": {
                                                        "status": 1
                                                        }
                                                }`)
                return
        }</span>
        <span class="cov0" title="0">io.WriteString(w, `{"message" : "Can’t update services"}`)</span>
}
</pre>
		
		<pre class="file" id="file10" style="display: none">package CONTROLLERS

import (
        "ROOMS/BUSINESS"
        "encoding/json"
        "io"
        "net/http"
)

func (a *ApiDB) GetAllUnit(w http.ResponseWriter, r *http.Request) <span class="cov8" title="1">{
        w.Header().Add("Content-Type", "application/json")

        listUnit, Ok := BUSINESS.GetAllUnits(a.Db)
        jsonlist, _ := json.Marshal(listUnit)
        if !Ok </span><span class="cov8" title="1">{
                io.WriteString(w, `{ "message": "Can’t get units" }`)
                return
        }</span>
        <span class="cov8" title="1">stringresult := `{"status": 200,
                                    "message": "Get units success",
                                    "data": {
                                "units":`
        stringresult += string(jsonlist)
        stringresult += "}}"
        io.WriteString(w, stringresult)</span>
}
</pre>
		
		<pre class="file" id="file11" style="display: none">package CONTROLLERS

import (
        "io"
        "net/http"
        "os"
        "strconv"
)

func UploadPicture(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{
        w.Header().Add("Content-Type", "application/json")
        file, handler, err := r.FormFile("file")
        if err != nil </span><span class="cov0" title="0">{
                io.WriteString(w, `{"message":"Can’t upload avatar"}`)
                return
        }</span>
        <span class="cov0" title="0">defer file.Close()

        f, err := os.OpenFile("./public/images/avatars/"+handler.Filename, os.O_WRONLY|os.O_CREATE, 0666)
        if err != nil </span><span class="cov0" title="0">{
                io.WriteString(w, `{"message":"Can’t upload avatar"}`)
                return
        }</span>
        <span class="cov0" title="0">defer f.Close()
        io.Copy(f, file)
        io.WriteString(w, `{ "status": 200,
    "message": "Upload avatar success",
    "data": {
        "fieldname": "file",
        "originalname": "`+handler.Filename+`",
        "destination": "public",
                 "mimetype": "`+handler.Header.Get("Content-Type")+`",
        "filename": "`+handler.Filename+`",
        "path": "public\\images\\avatars\\`+handler.Filename+`",
        "size": `+strconv.Itoa(int(handler.Size))+`
    }
}`)</span>
}
</pre>
		
		<pre class="file" id="file12" style="display: none">package CONTROLLERS

import (
        "ROOMS/BUSINESS"
        "ROOMS/DATABASE"
        "ROOMS/MODELS"
        "encoding/json"
        "github.com/dgrijalva/jwt-go"
        "github.com/gorilla/mux"
        "io"
        "net/http"
        "strconv"
        "time"
)

func (a *ApiDB) UserLogin(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{

        w.Header().Add("Content-Type", "application/json")
        p := MODELS.USERS{}
        err := json.NewDecoder(r.Body).Decode(&amp;p)
        if err != nil </span><span class="cov0" title="0">{
                io.WriteString(w, `{"message": "wrong format!"}`)
                return
        }</span>

        <span class="cov0" title="0">IsExsist, passok, user := BUSINESS.Login(a.Db, p.UserName, p.Pass)

        if !IsExsist </span><span class="cov0" title="0">{
                //w.WriteHeader(http.StatusUnauthorized)
                io.WriteString(w, `{"message": "Can't find user please sign in again!"}`)
                return
        }</span>

        <span class="cov0" title="0">if !passok </span><span class="cov0" title="0">{
                //w.WriteHeader(http.StatusUnauthorized)
                io.WriteString(w, `{"message": "Your password is wrong, please type again !"}`)
                return
        }</span>
        // expired after 1000 dates
        <span class="cov0" title="0">token := jwt.NewWithClaims(jwt.SigningMethodHS256, jwt.MapClaims{
                "user": user.UserName,
                "exp":  time.Now().Add(time.Hour * time.Duration(1000*24)).Unix(),
                "iat":  time.Now().Unix(),
        })
        tokenString, err := token.SignedString([]byte(DATABASE.APP_KEY))
        if err != nil </span><span class="cov0" title="0">{
                //w.WriteHeader(http.StatusInternalServerError)
                io.WriteString(w, `{"error":"token_generation_failed"}`)
                return
        }</span>

        //w.Write([]byte(`{"hello": "world"}`))
        <span class="cov0" title="0">stringresult := `{"message": "Login success","data":{"token":"` + tokenString + `","user":{ "id":` + strconv.Itoa(user.Id) + `,
                                                "username":"` + user.UserName + `","fullname":"` + user.FullName.String + `","role":` + strconv.Itoa(int(user.Role.Int64)) + `}}}`
        io.WriteString(w, stringresult)
        return</span>
}

func (a *ApiDB) UserRegister(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{
        w.Header().Add("Content-Type", "application/json")
        p := MODELS.RequestRegister{}
        err1 := json.NewDecoder(r.Body).Decode(&amp;p)
        if err1 != nil </span><span class="cov0" title="0">{
                io.WriteString(w, `{"message": "wrong format!"}`+err1.Error())
                return
        }</span>

        <span class="cov0" title="0">result, err := BUSINESS.Register(a.Db, p)
        if result </span><span class="cov0" title="0">{
                io.WriteString(w, `{"message": "Register success","data": {"status": 1}}`)
        }</span> else<span class="cov0" title="0"> {
                io.WriteString(w, `{"message":{"code":"`+err.Error()+`"}}`)
        }</span>
}

func (a *ApiDB) GetallUserName(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{
        // Query()["key"] will return an array of items,
        // we only want the single item.

        allusername := BUSINESS.GetAllUserName(a.Db)
        w.Header().Add("Content-Type", "application/json")
        if allusername == nil </span><span class="cov0" title="0">{
                //w.WriteHeader(http.StatusBadRequest)
                io.WriteString(w, `{"message": "unsuccess"}`)
                return
        }</span>
        //w.WriteHeader(200)
        <span class="cov0" title="0">io.WriteString(w, `{"message": "success","data":{`)
        for _, val := range allusername </span><span class="cov0" title="0">{
                io.WriteString(w, "\""+val+"\",")
        }</span>
        <span class="cov0" title="0">io.WriteString(w, "}}")</span>
}

func (a *ApiDB) GetUser(w http.ResponseWriter, r *http.Request) <span class="cov0" title="0">{
        w.Header().Add("Content-Type", "application/json")
        vars := mux.Vars(r)
        Id, err := strconv.Atoi(vars["Id"])
        //have not id --&gt; get all
        if err != nil </span><span class="cov0" title="0">{
                Id = -1
        }</span>
        <span class="cov0" title="0">List := BUSINESS.GetUsers(a.Db, Id)
        jsonlist, err1 := json.Marshal(List)
        result := List[0]
        if err1 != nil </span><span class="cov0" title="0">{
                return
        }</span>
        <span class="cov0" title="0">stringresult := `{"message": "Get Users success","status": 200,"data":{"user":`
        if len(List) == 1 </span><span class="cov0" title="0">{
                jsonresult, _ := json.Marshal(result)
                stringresult += string(jsonresult)
        }</span> else<span class="cov0" title="0"> {
                stringresult += string(jsonlist)
        }</span>
        <span class="cov0" title="0">stringresult += "}}"

        io.WriteString(w, stringresult)</span>
}
</pre>
		
		</div>
	</body>
	<script>
	(function() {
		var files = document.getElementById('files');
		var visible;
		files.addEventListener('change', onChange, false);
		function select(part) {
			if (visible)
				visible.style.display = 'none';
			visible = document.getElementById(part);
			if (!visible)
				return;
			files.value = part;
			visible.style.display = 'block';
			location.hash = part;
		}
		function onChange() {
			select(files.value);
			window.scrollTo(0, 0);
		}
		if (location.hash != "") {
			select(location.hash.substr(1));
		}
		if (!visible) {
			select("file0");
		}
	})();
	</script>
</html>
